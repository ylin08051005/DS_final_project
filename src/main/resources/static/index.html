<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
 <title>Coffee_Search</title>
 <meta charset="UTF-8">
 <style>
     body {
         font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
         background-color: #f4f6f9;
         display: flex;
         justify-content: center;
         align-items: center;
         height: 100vh;
         margin: 0;
     }
     .container {
         background-color: #ffffff;
         padding: 30px 40px;
         border-radius: 10px;
         box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
         max-width: 400px;
         width: 100%;
     }
     h2 {
         text-align: center;
         color: #333333;
         margin-bottom: 20px;
     }
     label {
         display: block;
         margin-top: 15px;
         color: #555555;
     }
     input {
         width: 100%;
         padding: 12px 15px;
         margin-top: 5px;
         border: 1px solid #cccccc;
         border-radius: 5px;
         box-sizing: border-box;
         font-size: 16px;
     }
     button {
         width: 100%;
         padding: 12px 15px;
         margin-top: 20px;
         background-color: #007BFF;
         border: none;
         border-radius: 5px;
         color: #ffffff;
         font-size: 16px;
         cursor: pointer;
         transition: background-color 0.3s ease;
     }
     button:hover {
         background-color: #0056b3;
     }
     hr {
         margin: 30px 0;
         border: none;
         border-top: 1px solid #eeeeee;
     }
     #apiResult {
         margin-top: 20px;
         font-size: 18px;
         color: #333333;
         text-align: center;
     }
 </style>
</head>
<body>
<div class="container">
 <h2>Coffee_Search</h2>

 <h3>使用API搜尋</h3>
 <form id="googleApiForm">
     <input type="text" id="apiInput" name="userInput" required placeholder="例如: 170">

     <button type="button" onclick="callGoogleApi()">search</button>
 </form>

 <div id="apiResult"></div>
</div>

<script>
 function callGoogleApi() {
     const query = document.getElementById('apiInput').value;
    const resultContainer = document.getElementById('apiResult');

    if (!query) {
        alert('請輸入搜尋關鍵字。');
        return;
    }

    // 顯示讀取中訊息
    resultContainer.innerHTML = '搜尋中，請稍候...';

    // 為了發送 POST 請求，我們需要準備請求主體 (body)
    // URLSearchParams 是一個簡單的方式來建立 "application/x-www-form-urlencoded" 格式的資料
    const params = new URLSearchParams();
    params.append('apiInput', query); // **修正點2: 參數名稱改為 'apiInput'**

    fetch('/api/coffee_search', {
        method: 'POST', // **修正點1: 明確指定使用 POST 方法**
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: params // 將參數放在 body 中發送
    })
    .then(response => {
        if (!response.ok) {
            // 如果伺服器回傳錯誤狀態碼 (例如 4xx, 5xx)
            throw new Error(`網路回應錯誤，狀態碼: ${response.status}`);
        }
        return response.json(); // 將回應解析為 JSON
    })
    .then(data => {
        // **修正點3: 正確處理回傳的 Map (在 JS 中是物件)**
        resultContainer.innerHTML = ''; // 清空先前的結果

        const keys = Object.keys(data);
        if (keys.length === 0) {
            resultContainer.innerText = '找不到相關結果。';
            return;
        }

        // 建立一個列表來顯示結果
        const ul = document.createElement('ul');
        keys.forEach(title => {
            const link = data[title];
            const li = document.createElement('li');
            const a = document.createElement('a');
            
            a.href = link;
            a.textContent = title;
            a.target = '_blank'; // 在新分頁開啟連結
            
            li.appendChild(a);
            ul.appendChild(li);
        });
        resultContainer.appendChild(ul);
    })
    .catch(error => {
        console.error('請求失敗:', error);
        resultContainer.innerText = '搜尋失敗，請稍後再試。';
    });
 }
</script>
</body>
</html>